# Knowledge Base Demo | Voiceflow
# Open AI GPT, Langchain, HNSWLib and Cheerio

This code utilizes Open AI GPT, Langchain, Redis Cache, and OpenSearch and Cheerio to fetch web content from URLs, create embeddings/vectors and save them in a local database. The knowledge base can then be used with GPT to answer questions.

## Quickstart Video
[![Watch the video](https://s3.amazonaws.com/com.voiceflow.studio/share/CleanShot-2023-03-17-at-14.03.29/CleanShot-2023-03-17-at-14.03.29.png)](https://www.loom.com/share/a4fccc7aac7d48548006570f6ac98576)


## Node.js
You need Node.js 18+ to run this code. You can download it here: https://nodejs.org/en/download/


## Table of Contents

1. [Getting Started](#getting-started)
2. [API Documentation](#api-documentation)
3. [Dependencies](#dependencies)

## Getting Started

### Installation

First, copy the `.env` file and set up required environment variables.

```bash
cp .env.example .env
```

To create the containers and install the required dependencies, run:

```bash
yarn build
```

### Starting the Server

Start the server by running:

```bash
yarn start
```

The server will listen on the port specified in the `.env` file (default is 3000).

## API Documentation

### Check server health

```
GET /api/health
```

#### Response

- `200 OK` on success

```json
{
  "success": true,
  "message": "Server is healthy"
}
```

### Clear Redis cache

```
GET /api/clearcache
```

#### Response

- `200 OK` on success

```json
{
  "success": true,
  "message": "Cache cleared"
}
```

### Delete a collection

```
DELETE /api/collection
```

#### Request

```json
{
  "name": "collection_name"
}
```

#### Response

- `200 OK` on success

```json
{
  "success": true,
  "message": "Collection collection_name has been deleted",
  "result": "result"
}
```

### Add content to OpenSearch

```
POST /api/add
```

#### Request

```json
{
  "url": "URL",
  "collection": "collection_name",
  "filter": "filter",
  "limit": 10,
  "chunkSize": 2000,
  "chunkOverlap": 250,
  "sleep": 0
}
```

#### Response

- `200 OK` on success

```json
{
  "response": "added",
  "collection": "collection_name"
}
```

### Get a response using live webpage as context

```
POST /api/live
```

#### Request

```json
{
  "url": "URL",
  "question": "Question",
  "temperature": 0
}
```

#### Response

- `200 OK` on success

```json
{
  "response": "response_text"
}
```

### Get a response using the vector store

```
POST /api/question
```

#### Request

```json
{
  "question": "Question",
  "collection": "collection_name",
  "model": "model_name",
  "temperature": 0,
  "max_tokens": 400
}
```

#### Response

- `200 OK` on success

```json
{
  "response": "response_text",
  "sources": ["source1", "source2"]
}
```

## Dependencies

Libraries and modules in use:

- `axios`: Performing HTTP requests.
- `cheerio`: Web scraping library for parsing and querying HTML.
- `crypto`: Creating hash digests for secure operations.
- `dotenv`: Loading environment variables from '.env' file.
- `express`: Web server for handling HTTP requests.
- `fs`: File system module for interacting with files.
- `http`: Creating HTTP server.
- `redis`: Redis client for implementing caching.
- `sitemap-xml-parser`: Parsing XML sitemaps.
- `url`: Parsing and manipulating URL strings.
- `@opensearch-project/opensearch`: OpenSearch client for indexing and searching.


## Using ngrok

To allow access to the app externally using the port set in the `.env` file, you can use ngrok. Follow the steps below:

1. Install ngrok: https://ngrok.com/download
2. Run `ngrok http <port>` in your terminal (replace `<port>` with the port set in your `.env` file)
3. Copy the ngrok URL generated by the command and use it in your Voiceflow Assistant API step.

This can be handy if you want to quickly test this in an API step within your Voiceflow Assistant.
